---
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  labels:
    app: docker-private-registry
  name: docker-private-registry-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: docker-private-registry
  template:
    metadata:
      labels:
        app: docker-private-registry
    spec:
      containers:
      - image: registry:2
        imagePullPolicy: IfNotPresent
        name: docker-private-registry
        env:
        - name: REGISTRY_HTTP_ADDR
          value: 0.0.0.0:5000
        - name: REGISTRY_HTTP_TLS_CERTIFICATE
          value: /certs/cert.crt
        - name: REGISTRY_HTTP_TLS_KEY
          value: /certs/cert.key
        ports:
        - containerPort: 5000
          protocol: TCP
        volumeMounts:
        - mountPath: /var/lib/registry
          name: image-store
        - mountPath: /certs
          name: certs
      volumes:
      - emptyDir: {} # THIS IS NOT PERSISTANT! WILL DELETE WITH POD!
        name: image-store
      - name: certs
        secret:
          secretName: registry-tls
          items:
          - key: tls.crt
            path: cert.crt
            mode: 256 # 0400 in decimal
          - key: tls.key
            path: cert.key
            mode: 256 # 0400 in decimal
---
apiVersion: v1
kind: Service
metadata:
  labels:
    service: docker-private-registry
  name: docker-private-registry
spec:
  ports:
  - nodePort: 30500
    port: 5000
    protocol: TCP
    targetPort: 5000
  selector:
    app: docker-private-registry
  type: NodePort

---
apiVersion: v1
kind: Secret
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVERENDQXZTZ0F3SUJBZ0lVZTlRbnd1emZNMnd2NkxMRzdQSXQ4N3ZDdno0d0RRWUpLb1pJaHZjTkFRRUwKQlFBd2NERUxNQWtHQTFVRUJoTUNWVk14RlRBVEJnTlZCQWdUREZCbGJtNXplV3gyWVc1cFlURVRNQkVHQTFVRQpCeE1LU0dGeWNtbHpZblZ5WnpFVE1CRUdBMVVFQ2hNS1MzVmlaWEp1WlhSbGN6RUxNQWtHQTFVRUN4TUNRMEV4CkV6QVJCZ05WQkFNVENrdDFZbVZ5Ym1WMFpYTXdIaGNOTVRreE1ESTRNVGt5T0RBd1doY05NakF4TURJM01Ua3kKT0RBd1dqQnhNUXN3Q1FZRFZRUUdFd0pWVXpFVk1CTUdBMVVFQ0JNTVVHVnVibk41YkhaaGJtbGhNUk13RVFZRApWUVFIRXdwSVlYSnlhWE5pZFhKbk1STXdFUVlEVlFRS0V3cExkV0psY201bGRHVnpNU0V3SHdZRFZRUUxFeGhMCmRXSmxjbTVsZEdWeklGUm9aU0JCYkhSaE15QlhZWGt3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXcKZ2dFS0FvSUJBUUREdXVsdFJ1S0QwcWNKNlhBM0xoL0FJcEo0MVB2cXdVYkdBcnRWOFRSazJVb2paZS9XdWJyUwpEeVY2WXNld2NzMEpScmJsWERsdUsrWGtFQU1wWW95RDgvRVVtKzlyRzBYeGZJbVRtdURXQ1B2Vml3T2Q0QnVICjVQejFpejRPQ2xRckJROXY2MXJzcDUwenVjRDJhZW43MCtTQVZIQ0owOFhWMkJLd0REaXFxbFJEd3ZRNWU4c2gKL29yOXNYbjV0VTVseXNhRTRndmRZT2dhazZoVFJhVm9VeHFSOVlHL200eXV4aTRnOVNBV0R3MWE4SUJJSjlySQpTdlhMaXllMjlCVjkrQ0tRQ3h4OWg4MUpFZ3FFSFVDcVhPL1RmdmlYdmVDK0tIRFdoR3ZORlJFT2tIZ04yOTZZCmlMa1BQcGQydDRjd2diTjVmbXg5bWVjMUkyd084UmxiQWdNQkFBR2pnWnd3Z1prd0RnWURWUjBQQVFIL0JBUUQKQWdXZ01CMEdBMVVkSlFRV01CUUdDQ3NHQVFVRkJ3TUJCZ2dyQmdFRkJRY0RBakFNQmdOVkhSTUJBZjhFQWpBQQpNQjBHQTFVZERnUVdCQlRkOStvbTdPZ2tHdDI1cGIzdjB3c1lhTFp4UmpBZkJnTlZIU01FR0RBV2dCU1ZjTWZJCjk5NXhZaEZJbzV1eTNxOUJLaXJvdFRBYUJnTlZIUkVFRXpBUmdnbHNiMk5oYkdodmMzU0hCSDhBQUFFd0RRWUoKS29aSWh2Y05BUUVMQlFBRGdnRUJBT2Q4Tml6bGNLZWVldHpDUWtRZlZxQ1lTekVGdGtXKzJWUEdoYStnVnlOcgp1bDBPY1ovRnE3ZlE2STlzMmtYbUV6Q1lkRkFscWxqaktlTXd4SXVqTVpiUDhMZjN4TWRYQ3pkdEdyV2VncW4zCml3cTA3b1FISG42YW83dCs1bE9NMHliSW4rUzdNOXNVbjZ6b3NxTnlXNFpUNENOVnV2M0ZpK2FWcFF2eGYrODAKSWYyRHJBVzJGVUdyRnZZRjkrYWtUY3JkWUttWnhCQThaRGptamNHcGtIb0JJY2dqYjV5VmFid0pkU1VFcDVwVQpqY3ZQbFFXSFlqRzhKYjdQbVA1SmJGVkZNUXh6aFZCOEpVM3FMbWRwYUNBK1R1blQyMVlua1F6MVh2UUZVTXNYCnoydWlNWGlmaGJQaCtrbGR5ZkhyL2o0MkZvK1N6Z1Fnek1rclBpQk1ENGM9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcGdJQkFBS0NBUUVBdzdycGJVYmlnOUtuQ2Vsd055NGZ3Q0tTZU5UNzZzRkd4Z0s3VmZFMFpObEtJMlh2CjFybTYwZzhsZW1MSHNITE5DVWEyNVZ3NWJpdmw1QkFES1dLTWcvUHhGSnZ2YXh0RjhYeUprNXJnMWdqNzFZc0QKbmVBYmgrVDg5WXMrRGdwVUt3VVBiK3RhN0tlZE03bkE5bW5wKzlQa2dGUndpZFBGMWRnU3NBdzRxcXBVUThMMApPWHZMSWY2Sy9iRjUrYlZPWmNyR2hPSUwzV0RvR3BPb1UwV2xhRk1ha2ZXQnY1dU1yc1l1SVBVZ0ZnOE5XdkNBClNDZmF5RXIxeTRzbnR2UVZmZmdpa0FzY2ZZZk5TUklLaEIxQXFsenYwMzc0bDczZ3ZpaHcxb1JyelJVUkRwQjQKRGR2ZW1JaTVEejZYZHJlSE1JR3plWDVzZlpubk5TTnNEdkVaV3dJREFRQUJBb0lCQVFDRHM0ZFNFbnBrZlNBTQptVmo2cUR5UkNqSkl2L2RxdFBhc1VqWS8wL2VQVEc2SWR4VDFCVEJpRy9MNThQR3hGdTVFS2FMem5pUytyeWNYCldIYm9KL21vNkVIMXZoOVJrSjUxcVhqaEt6dlNpV1Q3QVhsRGlBSytaQ1NhREVHTExRUUpsblFXdU9VTGpKVkkKc3RyV2M5b1BxenA3NTFWNlNGYzhWeEhzQjYweG1CRERoZGhlS2VwelZtSTI5YmRnS1krMWtMM21XNi9XaS9vRApTTTlEYk5waDFXTmhxQmxpbTZEdUFQRXluR1hQSml3S0FxcDRYUnZEYXRsakE1ajlXK1Nyb3psOEc1NW5QY3BMCmQ3aXprM3ArZXB3TVhYazFGcFVMeWZVWVNiNEJkOHRmY0FPYmc4QzVVRG85eFYvckRlS1QwTHJFVGduTHE1K3cKa2xVbVJOL1JBb0dCQVBJYjNaZEUrYzUxWXdubnIvaFdCNTBpL2VjRkNJT3NPd2ZkOUt3TTNUZERsalZuUmt6dwpPSW11MTQrWnF2VFVlbWxqTURvcnk1TzVBc2EyTXFWbzVXM0VaeVpjaG9HdTZNT0xCVFR3WVQwZ0dCRzRCWjVoCm1uczUydytTbHF3ZUhsbHlVTE5hUWV0ZlNVR0dyNWdVbEMwbDBjK3Nob2J1MjZBdnBjT01EYTZYQW9HQkFNNzEKMC9LdklpT0VCaDFQSVVWUzBVZUVmV255d3VQdjFBMnZRaVVKdy8zbW1ZdTJuZ0ZOUXcveWxLMWtlOWtPY3JVcwphWWRzN1ozOEJ6ZnVidWZZUm5HSG5scWNNUjlLSWZYMlgySk02OEY4K3UzSmxvSkRzMWZCbHBvdHVYejVYWEVzCmcxN0pqSWJuTGVvWUl1VGN5dWV4RHRsSmduRzdud21LN2lSMkpzZmRBb0dCQUp1dXEza0FFNXBkQlloekFVYXgKRzBoQ0hmNlZ6L25Mb0ZIWXVlS0FpeWRrUUl5cWtod2JSRi9VbkN4czVlOTFTaG5HZkZhTG51YW95MDQ0RHEwcQpuSTFQQS8wNDlnMGlDZTdqMEQ5UWExYkE4bmxDV2VxVVhKL3NmaDZ2WmsvYk5pelNRMjV4Rlg1aTBWcGZYejV0CnpUS1M1UzJqaFFYelJpcmxPTFJidE5pVkFvR0JBSTVPNnhhTTVtU1ZlNzdia24wZ25WY1grMFRHOE12Yk5XelQKZmlBSnZ3THZkZFZrRlBIQU5zVFlnUE5aak8rTHg4UmNiWlA1aXNwL2FsZERWRytIZjZqQklGb2QzSWt2YUhyQQpsb1g1Ym9MMWRYWGNqK215czdjOEhscVY1bDNRK2plLzYvVlprWStSbHpqSXIvVysvS2FrVVJtSU9uSUtHU2x1CnBxSGJ2SDdoQW9HQkFMV0Z1TnpDQXdsUUVPTGt1RG1Qbi9uRnhrT3VFSkE4UUcxazRoOGwydGtLY0lBeVcyZTkKUzZZL05QZm0rWXc3Mnd6NU0xUkJ6UEFiYXZJN1ZaOWNDajVqV3pGaUU5Nno5SDVnMXErU2xxci9vTnJtUXFsVgpLMzRMK2VleVlmUmVxT0lzTGozN1JvZS9TNU00TnQxQmpJRkhXdGJVRXlYV05zSm40TVdkeUxWZwotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
metadata:
  name: registry-tls
  namespace: default
type: Opaque

